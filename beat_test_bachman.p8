pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
// main

// setup stage + player
function _init()

 // setup stage code here

 // create player
 // sp=player sprite number
 // score=player's score
 p={
  x=59,
  y=59,
  sp=16,
  score=0
 }
 
 // keep track of how long since last note
 notetime = 0
 
 // store which side note came from
 note = {}
 note.left = false
 note.right = false
 note.top = false
 note.bottom = false
 note.x = -10
 note.y = -10
 note.sp = 3
 camera(0,0)
 
 notetimecheck = 0
 playertimecheck = 0
 
// new_note()
end

// update player hit location
// update note movement
function _update()
//  update_player()
 move_player() -- move the player
 check_note() -- check to see if note needs to move
	-- send player back to original positioin after 5 frames
 if(playertimecheck == 7) then 
 	go_back() -- move player back to original position
 	playertimecheck = 0 
 end
 playertimecheck = playertimecheck + 1
 -- move note closer after 5 frames
 if(notetimecheck == 5) then 
 	update_note()
 	notetimecheck = 0
 end
 notetimecheck = notetimecheck + 1
end

// draw sprites
function _draw()
 cls()
 map(0,0)
 spr(p.sp,p.x,p.y) --player
 spr(note.sp, note.x, note.y)
 
 -- commented out for testing
// spr(7,p.x-6,p.y)
// spr(7,p.x+6,p.y)
// spr(7,p.x,p.y-6)
// spr(7,p.x,p.y+6)
end

// update functions

--allows player to hit notes
--that coming from all directions
function update_player()
 if btn(⬆️) then
  
 end
 if btn(⬇️) then
  // hit note downwards
  // update sprite location
 end
 if btnp(0) then
  // hit note left
  // update sprite location
 end
 if btn(➡️) then
  // hit note right
  // update sprite location
 end
end

-- move notes towards player
function update_note()
	if (note.right) then
		note.x = note.x - 8
	end 
	if(note.left) then
		note.x = note.x + 8
	end
	if(note.top) then
		note.y = note.y - 8
	end
	if(note.bottom) then
		note.y = note.y - 8
	end
	-- if player hits note
	if(note.x == p.x and note.y == p.y) then
		success()
	-- if player misses note
	elseif(note.x == 59 and note.y == 59) then 
		failure()
	end
	
end

-- generate a new note from a random direction
function new_note() 
	note.left = false
	note.right = false
	note.top = false
	note.bottom = false
	local i = flr(rnd(4))
	-- coming from left
	if (i == 0) then 
		note.x = 0
		note.y = 59
		note.left = true		
	end
	-- coming from right
	if (i == 1) then
		note.x = 59 * 2
		note.y = 59
	 note.right = true
	end
	-- coming from top
	if (i == 2) then
		note.x = 59
		note.y = 0
		note.top = true
	end
	-- coming from bottom
	if (i == 3) then 
		note.x = 59
		note.y = 59 * 2
		note.bottom = true
	end
end

-- keep notes for 35 frames
function check_note() 
	if (notetime == 35) then
		new_note()
		notetime = 0
	end
	notetime = notetime + 1
end

-- move player in direction they press
function move_player()
	local new_x, new_y = p.x, p.y
	if(btnp(0)) then
		new_x-=8
	end
 if(btnp(1)) then
  new_x+=8
 end
	if(btnp(2)) then
	 new_y-=8
	end
	if(btnp(3)) then
	 new_y+=8
	end
	p.x = new_x
	p.y = new_y
	
end

-- sends player back to origin
function go_back() 
	p.x = 59
	p.y = 59
end

-- player hits the note
function success() 
	note.left = false
 note.right = false
 note.top = false
 note.bottom = false
 note.x = -10
 note.y = -10 
 p.sp = 9
end

-- player misses the note
function failure()
	note.left = false
 note.right = false
 note.top = false
 note.bottom = false
 note.x = -10
 note.y = -10
 p.sp = 17
end
__gfx__
00000000066666600000000000033000000000000099990000077000007777004444444400000000444444444444444444444444444444440000000000000000
0000000066000066082222800037b30000cccc000997799000177100070000704ffffff400aaaa00454444444444444445444444444244440000000000000000
0070070060000006027788200377bb300c7cccc09979999901111110700000074f5555f40aaaaaa0444444444644444444444444444444440000000000000000
0007700060066006027888203bbbbbb3c7cccccc9799999977111177700000074f5335f4aa5aa5aa444444444444444444444444444445550000000000000000
0007700060066006028888203bbbbbb31cccccc19799999977111177700000074f5335f4aaaaaaaa444444444444444445555554444444440000000000000000
00700700600000060288882003bbbb3001cccc109999999901111110700000074f5555f4a5aaaa5a444224444444444444444444446444220000000000000000
000000006600006608222280003bb300001cc1000999999000177100070000704ffffff40a5555a0444444444444444244444444444444440000000000000000
00000000066666600000000000033000000110000099990000077000007777004444444400aaaa00554444444454444444444446444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444644444444444424444444444440000000000000000
00aaaa0000aaaa000000000000000000000000000000000000000000000000000000000000000000445544444444444444444444444444450000000000000000
0aaaaaa00aaaaaa00000000000000000000000000000000000000000000000000000000000000000444444444444444444444444554664440000000000000000
aa5aa5aaaa5aa5aa0000000000000000000000000000000000000000000000000000000000000000444444444454444444555464444444440000000000000000
aaaaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000000000000000000444555544444444444444444444444440000000000000000
a555555aaa5555aa0000000000000000000000000000000000000000000000000000000000000000644444444444444444422444444444450000000000000000
0aaaaaa00a5aa5a00000000000000000000000000000000000000000000000000000000000000000444444444444422244444444454455540000000000000000
00aaaa0000aaaa000000000000000000000000000000000000000000000000000000000000000000444444444644444444444444444454440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444445444444444444444444444244540000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444564444446644444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444446444444445555444444444640000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000442444444444244444444222444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444455554444444445554444444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000446644444444442444444454444424440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444444544444444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444544444664444444444444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444444442445555554440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444444444444444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444466444444444444444555544444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000224444444444555564444444444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444455555444444444446444444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444444444444444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444422444444444444444440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000444555444464444444444555444424440000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
008008000800000000b00b000b00000000c00c000c00000000900900090000000000000000000000000000000000000000000000000000000000000000000000
0008080080000000000b0b00b0000000000c0c00c000000000090900900000000000000000000000000000000000000000000000000000000000000000000000
0008080800888000000b0b0b00bbb000000c0c0c00ccc00000090909009990000000000000000000000000000000000000000000000000000000000000000000
08880888088888000bbb0bbb0bbbbb000ccc0ccc0ccccc0009990999099999000000000000000000000000000000000000000000000000000000000000000000
8888888888888800bbbbbbbbbbbbbb00cccccccccccccc0099999999999999000000000000000000000000000000000000000000000000000000000000000000
08888888888888000bbbbbbbbbbbbb000ccccccccccccc0009999999999999000000000000000000000000000000000000000000000000000000000000000000
8888888888888800bbbbbbbbbbbbbb00cccccccccccccc0099999999999999000000000000000000000000000000000000000000000000000000000000000000
08880888088888000bbb0bbb0bbbbb000ccc0ccc0ccccc0009990999099999000000000000000000000000000000000000000000000000000000000000000000
0008080800888000000b0b0b00bbb000000c0c0c00ccc00000090909009990000000000000000000000000000000000000000000000000000000000000000000
0008080080000000000b0b00b0000000000c0c00c000000000090900900000000000000000000000000000000000000000000000000000000000000000000000
008008000800000000b00b000b00000000c00c000c00000000900900090000000000000000000000000000000000000000000000000000000000000000000000
__map__
0a0b0c0d0a0b0c0d0a0b0c0d0a0b0c0d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1b1c1d1a1b1c1d1a1b1c1d1a1b1c1d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2b2c2d2a2b2c2d2a2b2c2d2a2b2c2d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3a3b3c3d3a3b3c3d3a3b3c3d3a3b3c3d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0b0c0d0a0b0c0d0a0b0c0d0a0b0c0d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1b1c1d1a1b1c1d1a1b1c1d1a1b1c1d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2b2c2d2a2b2c2d2a2b2c2d2a2b2c2d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3a3b3c3d3a3b3c2a3a3b3c3d3a3b3c3d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0b0c0d0a0b0c0d1a0b0c0d0a0b0c0d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1b1c1d1a1b1c1a1a1b1c1d1a1b1c1d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2b2c2d2a2b2c2d2a2b2c2d2a2b2c2d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3a3b3c3d3a3b3c3d3a3b3c3d3a3b3c3d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0b0c0d0a0b0c0d0a0b0c0d0a0b0c0d09090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1b1c1d1a1b1c1d1a1b1c1d1a1b1c1d09090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2b2c2d2a2b2c2d2a2b2c2d2a2b2c2d09090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3a3b3c3d3a3b3c3d3a3b3c3d3a3b3c3d09090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0909090909090909090909090909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000909090909090909090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000009090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
